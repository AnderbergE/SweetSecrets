<!doctype html>
<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.0rc1/angular.js"></script>
	<script type="text/javascript">
		var app = angular.module('MyApp', []);

		function ColorSlider($scope) {
			$scope.r = {name: "red", value: 120};
			$scope.g = {name: "green", value: 160};
			$scope.b = {name: "blue", value: 255};
			$scope.$watch('r.value', function(value, old) { setColor($scope.r, value, old); });
			$scope.$watch('g.value', function(value, old) { setColor($scope.g, value, old); });
			$scope.$watch('b.value', function(value, old) { setColor($scope.b, value, old); });
			$scope.active = null;

			$scope.sliderActive = function (color, event) {
				var body = document.querySelector("body");
				if (color) {
					$scope.active = color;
					$scope.sliderChange(event);
					body.onmousemove = function (e) {
						$scope.$apply($scope.sliderChange(e ? e : window.event));
					};
					body.onmouseup = function () {
						$scope.$apply($scope.sliderActive());
					};
				} else {
					$scope.active = null;
					body.onmousemove = null;
					body.onmouseup = null;
				}
			}

			$scope.sliderChange = function (event) {
				if ($scope.active) {
					var head = document.querySelector("." + $scope.active.name + " .slider-header");
					var pos = document.querySelector("." + $scope.active.name + " .slider-line").getBoundingClientRect();
					var mouseX = event.clientX;

					if (mouseX < pos.left)
						$scope.active.value = 0;
					else if (mouseX > pos.right)
						$scope.active.value = 255;
					else
						$scope.active.value = Math.round((mouseX - pos.left) / (pos.right - pos.left)*255);
				}
			}
			
			function setColor (color, value, old) {
				value = value == "" ? 0 : parseInt(value);
				color.value = isNaN(value) ? old : value < 0 ? 0 : value > 255 ? 255 : value;
				color.intensity = value/255;
				color.others = 255 - color.value;
			}
		}

		
	</script>
	<style>
		html { height: 100%; margin: 0; }
		body { height: 95%; margin: 0; padding: 2%; }
		
		.container {
			background: beige;
			height: 65%;
			margin: auto;
			padding: 2%;
			width: 90%;
		}
		
		.color-slider {
			box-sizing: border-box;
			padding-right: 6em;
			position: relative;
			width: 100%
			
			-webkit-touch-callout: none;
			-webkit-user-select: none;
			-khtml-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;
		}
		.slider {
			margin: 2% auto;
			height: 3em;
			position: relative;
			width: 100%;
		}
		.slider-line {
			background: ghostwhite;
			box-shadow: 0 1px 2px 0 gray inset, 0 -1px 2px 0 snow inset;
			border-radius: 1em;
			height: 1em;
			left: 0;
			position: absolute;
			top: 1em;
			width: 100%;
		}
		.slider-header {
			cursor: move;
			left: 0;
			position: absolute;
			top: 0;
		}
		.slider-header:after {
			background: inherit;
			border-radius: 50%;
			content: "";
			height: 3em;
			left: -1.5em;
			position: absolute;
			top: 0;
			width: 3em;
		}
		.red .slider-header:after {
			box-shadow: 0 0 2px 1px red inset, 0 0 2px 1px red, 2px 2px 6px 1px gray;
		}
		.green .slider-header:after {
			box-shadow: 0 0 2px 1px lime inset, 0 0 2px 1px lime, 2px 2px 6px 1px gray;
		}
		.blue .slider-header:after {
			box-shadow: 0 0 2px 1px blue inset, 0 0 2px 1px blue, 2px 2px 6px 1px gray;
		}
		.slider-number {
			border: none;
			background: snow;
			border-radius: 50%;
			box-shadow: 0 1px 2px 0 gray inset, 0 -1px 2px 0 snow inset;
			font-size: 1em;
			height: 3em;
			position: absolute;
			right: 0;
			text-align: center;
			top: 0;
			width: 3em;
		}

		.combined-color {
			border-radius: 50%;
			height: 5em;
			margin: 3em auto;
			width: 5em;
		}
	</style>
</head>
<body ng-app="MyApp" id="ng-app">
	<div class="container" ng-controller="ColorSlider">
		<div class="color-slider red">
			<div class="slider" ng-mousedown="sliderActive(r, $event)">
				<div class="slider-line"></div>
				<div class="slider-header" ng-style="{
					'background-color': 'rgb(255, ' + r.others + ', ' + r.others + ')',
					'left': r.intensity * 100 + '%'}">
				</div>
			</div>
			<input class="slider-number" ng-model="r.value" />
		</div>
		<div class="color-slider green">
			<div class="slider" ng-mousedown="sliderActive(g, $event)">
				<div class="slider-line"></div>
				<div class="slider-header" ng-style="{
					'background-color': 'rgb(' + g.others + ', 255, ' + g.others + ')',
					'left': g.intensity * 100 + '%'}">
				</div>
			</div>
			<input class="slider-number" ng-model="g.value" />
		</div>
		<div class="color-slider blue">
			<div class="slider" ng-mousedown="sliderActive(b, $event)">
				<div class="slider-line"></div>
				<div class="slider-header" ng-style="{
					'background-color': 'rgb(' + b.others + ', ' + b.others + ', 255)',
					'left': b.intensity * 100 + '%'}">
				</div>
			</div>
			<input class="slider-number" ng-model="b.value" />
		</div>
		<div class="combined-color" ng-style="{
			'background-color': 'rgb(' + (255-r.others) + ', ' + (255-g.others) + ', ' + (255-b.others) + ')'}">
		</div>
	</div>
</body>
</html>
